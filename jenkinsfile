pipeline {
    agent any  // Runs on any available agent

    stages {
        stage('Clone') {
            steps {
                // Clone your repository
                git url: 'https://github.com/Yogeshpisal216/My_Project.git', branch: 'main'
            }
        }

        stage('Build') {
            steps {
                echo 'Building the project..'
                
                cd My_Project/nginx
                docker build . -t nginx  
               

                cd ..
                cd python
                docker build . -t python
                
            }
        }

        stage('Push') {
            steps {
                echo 'Push to docker hub..'
                
                sh "docker login -u yogi2112 -p <password>"
                sh "docker tag nginx yogi2112/nginx:latest"
                sh "docker push yogi2112/nginx:latest"
                sh "docker tag nginx yogi2112/flask:latest"
                sh "docker push yogi2112/flask:latest"

            }
        }

        stage('Deploy') {
            steps {
                echo 'Deploying application..'

                docker rm -f nginx-con1 python-con2 2>/dev/null || true

                docker run -it --name nginx-con1 -d -p 80:80 nginx

                docker run -it --name python-con2 -d -p 1010:5000 python
            }
        }
    }
}